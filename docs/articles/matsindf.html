<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use Cases and Examples for matsindf • matsindf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Cases and Examples for matsindf">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">matsindf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/matsindf.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/iris_pca.html">Using matsindf for principal components analysis</a></li>
    <li><a class="dropdown-item" href="../articles/midf_apply_primer.html">A matsindf_apply primer</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MatthewHeun/matsindf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use Cases and Examples for matsindf</h1>
                        <h4 data-toc-skip class="author">Matthew Kuperus
Heun</h4>
            
            <h4 data-toc-skip class="date">2025-03-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MatthewHeun/matsindf/blob/HEAD/vignettes/matsindf.Rmd" class="external-link"><code>vignettes/matsindf.Rmd</code></a></small>
      <div class="d-none name"><code>matsindf.Rmd</code></div>
    </div>

    
    
<!-- Establish some helpful LaTeX shortcuts for equations -->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Matrices are important mathematical objects, and they often describe
networks of flows among nodes. Example networks are given in the
following table.</p>
<table class="table">
<thead><tr class="header">
<th align="left">System type</th>
<th align="left">Flows</th>
<th align="left">Nodes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Ecological</td>
<td align="left">nutrients</td>
<td align="left">organisms</td>
</tr>
<tr class="even">
<td align="left">Manufacturing</td>
<td align="left">materials</td>
<td align="left">factories</td>
</tr>
<tr class="odd">
<td align="left">Economic</td>
<td align="left">money</td>
<td align="left">economic sectors</td>
</tr>
</tbody>
</table>
<p>The power of matrices lies in their ability to organize network-wide
calculations, thereby simplifying the work of analysts who study entire
systems.</p>
<p>But <a href="https://en.wikipedia.org/wiki/Wouldn%27t_It_Be_Nice" class="external-link">wouldn’t it
be nice</a> if there were an easy way to create <code>R</code> data
frames whose entries were not numbers but entire matrices? If that were
possible, matrix algebra could be performed on columns of similar
matrices.</p>
<p>That’s the reason for <code>matsindf</code>. It provides functions to
convert a suitably-formatted <a href="https://tidyr.tidyverse.org/articles/tidy-data.html" class="external-link">tidy</a> data
frame into a data frame containing a column of matrices.</p>
<p>Furthermore, <code>matsbyname</code> is a sister package that</p>
<ul>
<li>provides matrix algebra functions that respect names of matrix rows
and columns (<code>dimnames</code> in <code>R</code>) to free the
analyst from the task of aligning rows and columns of operands
(matrices) passed to matrix algebra functions and</li>
<li>allows matrix algebra to be conducted within data frames using <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>, <a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a>, and other <a href="https://www.tidyverse.org" class="external-link">tidyverse</a> functions.</li>
</ul>
<p>When used together, <code>matsindf</code> and <code>matsbyname</code>
allow analysts to wield simultaneously the power of both <a href="https://en.wikipedia.org/wiki/Matrix_(mathematics)" class="external-link">matrix
mathematics</a> and <a href="https://www.tidyverse.org" class="external-link">tidyverse</a>
functional programming.</p>
<p>This vignette demonstrates the use of these packages and suggests a
workflow to accomplish sophisticated analyses using <em>matrices in data
frames</em> (<code>matsindf</code>).</p>
</div>
<div class="section level2">
<h2 id="data-ukenergy2000">Data: <code>UKEnergy2000</code><a class="anchor" aria-label="anchor" href="#data-ukenergy2000"></a>
</h2>
<p>To demonstrate the use of <code>matsindf</code> functions, consider a
network of energy flows from the environment, through transformation and
distribution processes, and, ultimately, to final demand. Such energy
flow networks are called energy conversion chains (ECCs), and this
example is based on an approximation to a portion of the UK’s ECC circa
2000. (Note that these data are to be used for demonstration purposes
only and have been rounded to 1–2 significant digits.) These example
data first appeared in Figures 3 and 4 of Heun, Owen, and Brockway <span class="citation">(2018)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">UKEnergy2000</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Country Year Ledger.side      Flow.aggregation.point              Flow</span></span>
<span><span class="co">#&gt; 1      GB 2000      Supply Total primary energy supply Resources - Crude</span></span>
<span><span class="co">#&gt; 2      GB 2000      Supply Total primary energy supply    Resources - NG</span></span>
<span><span class="co">#&gt;   Product E.ktoe</span></span>
<span><span class="co">#&gt; 1   Crude  50000</span></span>
<span><span class="co">#&gt; 2      NG  43000</span></span></code></pre></div>
<p><code>Country</code> and <code>Year</code> contain only one value
each, <code>GB</code> and <code>2000</code> respectively. Following
conventions of the <a href="https://www.iea.org" class="external-link">International Energy
Agency</a>’s <a href="https://www.iea.org/data-and-statistics/data-product/world-energy-balances" class="external-link">energy
balance tables</a>,</p>
<ul>
<li>
<code>Ledger.side</code> indicates <code>Supply</code> or
<code>Consumption</code>;</li>
<li>
<code>Flow.aggregation.point</code> indicates how data are to be
aggregated;</li>
<li>
<code>Flow</code> indicates the industry, machine, or final demand
sector for this flow;</li>
<li>
<code>Product</code> indicates the energy carrier for this flow;
and</li>
<li>
<code>E.ktoe</code> gives the magnitude of this flow in <a href="https://www.eia.gov/energyexplained/units-and-calculators/energy-conversion-calculators.php" class="external-link">units</a>
of kilotons of oil equivalent (ktoe).</li>
</ul>
<p>Each flow is its own observation (its own row) in the
<code>UKEnergy2000</code> data frame, making it <a href="https://tidyr.tidyverse.org/articles/tidy-data.html" class="external-link">tidy</a>.</p>
<p>The remainder of this vignette demonstrates an analysis conducted
using the <code>UKEnergy2000</code> data frame as a basis. It:</p>
<ul>
<li>shows how to <em>collapse</em> and spread the data into appropriate
matrices stored in columns of a data frame,</li>
<li>demonstrates analyzing the matrices with <code>matsbyname</code>
functions,</li>
<li>illustrates <em>expand</em>ing the matrices back into a tidy data
frame, and</li>
<li>uses <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot</a> to graph the
results.</li>
</ul>
</div>
<div class="section level2">
<h2 id="suggested-workflow">Suggested workflow<a class="anchor" aria-label="anchor" href="#suggested-workflow"></a>
</h2>
<div class="section level3">
<h3 id="prepare-for-collapse">Prepare for <em>collapse</em><a class="anchor" aria-label="anchor" href="#prepare-for-collapse"></a>
</h3>
<p>The <code>EnergyUK2000</code> data frame is similar to “cleaned” data
from an external source: there are no missing entries, and it is <a href="https://tidyr.tidyverse.org/articles/tidy-data.html" class="external-link">tidy</a>. But
the data are not organized as matrices, and additional metadata is
needed.</p>
<p>The <code>collapse_to_matrices</code> function converts a tidy data
frame into a <code>matsindf</code> data frame using using information
within the tidy data frame. So the first task is to prepare for
<em>collapse</em> by adding metadata columns.</p>
<p><code>collapse_to_matrices</code> needs the following
information:</p>
<table class="table">
<colgroup>
<col width="57%">
<col width="42%">
</colgroup>
<thead><tr class="header">
<th align="right">argument to <code>collapse_to_matrices</code>
</th>
<th align="left">identifies</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right"><code>matnames</code></td>
<td align="left">Name of the input column of matrix names</td>
</tr>
<tr class="even">
<td align="right"><code>values</code></td>
<td align="left">Name of the input column of matrix entries</td>
</tr>
<tr class="odd">
<td align="right"><code>rownames</code></td>
<td align="left">Name of the input column of matrix row names</td>
</tr>
<tr class="even">
<td align="right"><code>colnames</code></td>
<td align="left">Name of the input column of matrix column name</td>
</tr>
<tr class="odd">
<td align="right"><code>rowtypes</code></td>
<td align="left">Optional name of the input column of matrix row
types</td>
</tr>
<tr class="even">
<td align="right"><code>coltypes</code></td>
<td align="left">Optional name of the input column of matrix column
types</td>
</tr>
</tbody>
</table>
<p>The following code gives the approach to adding metadata, appropriate
for this application, relying on <code>Ledger.side</code>, the sign of
<code>E.ktoe</code>, and knowledge about the rows and columns for each
matrix. Each type of network will have its own algorithm for identifying
row names, column names, row types, and column types in a tidy data
frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UKEnergy2000_with_metadata</span> <span class="op">&lt;-</span> <span class="va">UKEnergy2000</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Add a column indicating the matrix in which this entry belongs (U, V, or Y).</span></span>
<span>  <span class="fu">matsindf</span><span class="fu">:::</span><span class="fu"><a href="../reference/add_UKEnergy2000_matnames.html">add_UKEnergy2000_matnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Add columns for row names, column names, row types, and column types.</span></span>
<span>  <span class="fu">matsindf</span><span class="fu">:::</span><span class="fu"><a href="../reference/add_UKEnergy2000_row_col_meta.html">add_UKEnergy2000_row_col_meta</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Eliminate columns we no longer need</span></span>
<span>    Ledger.side <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    Flow.aggregation.point <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    Flow <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    Product <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    <span class="co"># Ensure that all energy values are positive, as required for analysis.</span></span>
<span>    E.ktoe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">E.ktoe</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">UKEnergy2000_with_metadata</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Country Year E.ktoe matname           rowname colname  rowtype coltype</span></span>
<span><span class="co">#&gt; 1      GB 2000  50000       V Resources - Crude   Crude Industry Product</span></span>
<span><span class="co">#&gt; 2      GB 2000  43000       V    Resources - NG      NG Industry Product</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="collapse">Collapse<a class="anchor" aria-label="anchor" href="#collapse"></a>
</h3>
<p>With the metadata now in place,
<code>UKEnergy2000_with_metadata</code> can be collapsed to a
<code>matsindf</code> data frame by the
<code>collapse_to_matrices</code> function. Much like
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise</a></code>, <code>collapse_to_matrices</code> relies
on grouping to indicate which rows of the tidy data frame belong to
which matrices. The usual approach is to <code>tidyr::group_by</code>
the <code>matnames</code> column and any other columns to be preserved
in the output, in this case <code>Country</code> and
<code>Year</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EnergyMats_2000</span> <span class="op">&lt;-</span> <span class="va">UKEnergy2000_with_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">matname</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/collapse_to_matrices.html">collapse_to_matrices</a></span><span class="op">(</span>matnames <span class="op">=</span> <span class="st">"matname"</span>, matvals <span class="op">=</span> <span class="st">"E.ktoe"</span>,</span>
<span>                       rownames <span class="op">=</span> <span class="st">"rowname"</span>, colnames <span class="op">=</span> <span class="st">"colname"</span>, </span>
<span>                       rowtypes <span class="op">=</span> <span class="st">"rowtype"</span>, coltypes <span class="op">=</span> <span class="st">"coltype"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>matrix.name <span class="op">=</span> <span class="va">matname</span>, matrix <span class="op">=</span> <span class="va">E.ktoe</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The remaining columns are Country, Year, matrix.name, and matrix</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">EnergyMats_2000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; $ Country     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GB", "GB", "GB"</span></span>
<span><span class="co">#&gt; $ Year        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2000, 2000, 2000</span></span>
<span><span class="co">#&gt; $ matrix.name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "U", "V", "Y"</span></span>
<span><span class="co">#&gt; $ matrix      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[11 x 9]&gt;&gt;, &lt;&lt;matrix[11 x 12]&gt;&gt;, &lt;&lt;matrix[4 x 2]&gt;&gt;</span></span>
<span></span>
<span><span class="co"># To access one of the matrices, try one of these approaches:</span></span>
<span><span class="op">(</span><span class="va">EnergyMats_2000</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">matrix.name</span> <span class="op">==</span> <span class="st">"U"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="st">"matrix"</span><span class="op">]</span><span class="op">]</span> <span class="co"># The U matrix</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;                Oil fields Oil refineries Crude dist. Diesel dist.</span></span>
<span><span class="co">#&gt; Crude               50000              0           0            0</span></span>
<span><span class="co">#&gt; Crude - Dist.           0          47000           0            0</span></span>
<span><span class="co">#&gt; Crude - Fields          0              0       47500            0</span></span>
<span><span class="co">#&gt; Diesel                  0              0           0        15500</span></span>
<span><span class="co">#&gt; Diesel - Dist.         50              0          25            0</span></span>
<span><span class="co">#&gt; Elect                   0              0           0            0</span></span>
<span><span class="co">#&gt; Elect - Grid           25             75          25            0</span></span>
<span><span class="co">#&gt; NG                      0              0           0            0</span></span>
<span><span class="co">#&gt; NG - Dist.              0              0           0            0</span></span>
<span><span class="co">#&gt; NG - Wells              0              0           0            0</span></span>
<span><span class="co">#&gt; Petrol                  0              0           0            0</span></span>
<span><span class="co">#&gt;                Gas wells &amp; proc. NG dist. Petrol dist. Elect. grid Power plants</span></span>
<span><span class="co">#&gt; Crude                          0        0            0           0            0</span></span>
<span><span class="co">#&gt; Crude - Dist.                  0        0            0           0            0</span></span>
<span><span class="co">#&gt; Crude - Fields                 0        0            0           0            0</span></span>
<span><span class="co">#&gt; Diesel                         0        0            0           0            0</span></span>
<span><span class="co">#&gt; Diesel - Dist.                50       25          250           0            0</span></span>
<span><span class="co">#&gt; Elect                          0        0            0        6400            0</span></span>
<span><span class="co">#&gt; Elect - Grid                  25       25            0           0          100</span></span>
<span><span class="co">#&gt; NG                         43000        0            0           0            0</span></span>
<span><span class="co">#&gt; NG - Dist.                     0        0            0           0        16000</span></span>
<span><span class="co">#&gt; NG - Wells                     0    41000            0           0            0</span></span>
<span><span class="co">#&gt; Petrol                         0        0        26500           0            0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span></span>
<span><span class="va">EnergyMats_2000</span><span class="op">$</span><span class="va">matrix</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># The V matrix</span></span>
<span><span class="co">#&gt;                   Crude - Dist. Diesel - Dist. Elect - Grid NG - Wells</span></span>
<span><span class="co">#&gt; Crude dist.               47000              0            0          0</span></span>
<span><span class="co">#&gt; Diesel dist.                  0          15150            0          0</span></span>
<span><span class="co">#&gt; Elect. grid                   0              0         6275          0</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc.             0              0            0      41000</span></span>
<span><span class="co">#&gt; NG dist.                      0              0            0          0</span></span>
<span><span class="co">#&gt; Oil fields                    0              0            0          0</span></span>
<span><span class="co">#&gt; Oil refineries                0              0            0          0</span></span>
<span><span class="co">#&gt; Petrol dist.                  0              0            0          0</span></span>
<span><span class="co">#&gt; Power plants                  0              0            0          0</span></span>
<span><span class="co">#&gt; Resources - Crude             0              0            0          0</span></span>
<span><span class="co">#&gt; Resources - NG                0              0            0          0</span></span>
<span><span class="co">#&gt;                   NG - Dist. Crude - Fields Diesel Petrol Petrol - Dist. Elect</span></span>
<span><span class="co">#&gt; Crude dist.                0              0      0      0              0     0</span></span>
<span><span class="co">#&gt; Diesel dist.               0              0      0      0              0     0</span></span>
<span><span class="co">#&gt; Elect. grid                0              0      0      0              0     0</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc.          0              0      0      0              0     0</span></span>
<span><span class="co">#&gt; NG dist.               41000              0      0      0              0     0</span></span>
<span><span class="co">#&gt; Oil fields                 0          47500      0      0              0     0</span></span>
<span><span class="co">#&gt; Oil refineries             0              0  15500  26500              0     0</span></span>
<span><span class="co">#&gt; Petrol dist.               0              0      0      0          26000     0</span></span>
<span><span class="co">#&gt; Power plants               0              0      0      0              0  6400</span></span>
<span><span class="co">#&gt; Resources - Crude          0              0      0      0              0     0</span></span>
<span><span class="co">#&gt; Resources - NG             0              0      0      0              0     0</span></span>
<span><span class="co">#&gt;                   Crude    NG</span></span>
<span><span class="co">#&gt; Crude dist.           0     0</span></span>
<span><span class="co">#&gt; Diesel dist.          0     0</span></span>
<span><span class="co">#&gt; Elect. grid           0     0</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc.     0     0</span></span>
<span><span class="co">#&gt; NG dist.              0     0</span></span>
<span><span class="co">#&gt; Oil fields            0     0</span></span>
<span><span class="co">#&gt; Oil refineries        0     0</span></span>
<span><span class="co">#&gt; Petrol dist.          0     0</span></span>
<span><span class="co">#&gt; Power plants          0     0</span></span>
<span><span class="co">#&gt; Resources - Crude 50000     0</span></span>
<span><span class="co">#&gt; Resources - NG        0 43000</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span></span>
<span><span class="va">EnergyMats_2000</span><span class="op">$</span><span class="va">matrix</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="co"># The Y matrix</span></span>
<span><span class="co">#&gt;                Transport Residential</span></span>
<span><span class="co">#&gt; Diesel - Dist.     14750           0</span></span>
<span><span class="co">#&gt; Elect - Grid           0        6000</span></span>
<span><span class="co">#&gt; NG - Dist.             0       25000</span></span>
<span><span class="co">#&gt; Petrol - Dist.     26000           0</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Product"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Sector"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="duplicate-for-purposes-of-illustration">Duplicate (for purposes of illustration)<a class="anchor" aria-label="anchor" href="#duplicate-for-purposes-of-illustration"></a>
</h3>
<p>Larger studies will include data for multiple countries and years.
The ECC data from UK in year <code>2000</code> can be duplicated for
<code>2001</code> and for a fictitious country <code>AB</code>. Although
the data are unchanged, the additional rows serve to illustrate the
functional programming aspects of the <code>matsindf</code> and
<code>matsbyname</code> packages.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Energy</span> <span class="op">&lt;-</span> <span class="va">EnergyMats_2000</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Create rows for a fictitious country "AB".</span></span>
<span>  <span class="co"># Although the rows for "AB" are same as the "GB" rows,</span></span>
<span>  <span class="co"># they serve to illustrate functional programming with matsindf.</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">EnergyMats_2000</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Country <span class="op">=</span> <span class="st">"AB"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">Year</span>, value <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Create a column for a second year (2001).</span></span>
<span>    `2001` <span class="op">=</span> <span class="va">`2000`</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">Year</span>, value <span class="op">=</span> <span class="va">matrix</span>, <span class="va">`2000`</span>, <span class="va">`2001`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># Now spread to put each matrix in a column.</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">matrix.name</span>, value <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">Energy</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 4</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ Country <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "AB", "AB", "GB", "GB"</span></span>
<span><span class="co">#&gt; $ Year    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2000", "2001", "2000", "2001"</span></span>
<span><span class="co">#&gt; $ U       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[11 x 9]&gt;&gt;, &lt;&lt;matrix[11 x 9]&gt;&gt;, &lt;&lt;matrix[11 x 9]&gt;&gt;, &lt;&lt;…</span></span>
<span><span class="co">#&gt; $ V       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[11 x 12]&gt;&gt;, &lt;&lt;matrix[11 x 12]&gt;&gt;, &lt;&lt;matrix[11 x 12]&gt;&gt;,…</span></span>
<span><span class="co">#&gt; $ Y       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;&lt;matrix[4 x 2]&gt;&gt;, &lt;&lt;matrix[4 x 2]&gt;&gt;, &lt;&lt;matrix[4 x 2]&gt;&gt;, &lt;&lt;ma…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="verify-data">Verify data<a class="anchor" aria-label="anchor" href="#verify-data"></a>
</h3>
<p>An important step in any analysis is data verification. For an ECC
analysis, it is important to verify that energy is conserved (i.e.,
energy is in balance) across all industries. Equations 1 and 2 in Heun,
Owen, and Brockway <span class="citation">(2018)</span> show that energy
balance is verified by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐖</mi><mo>=</mo><msup><mi>𝐕</mi><mi mathvariant="normal">T</mi></msup><mo>−</mo><mi>𝐔</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathbf{W} = \mathbf{V}^\mathrm{T} - \mathbf{U},</annotation></semantics></math></p>
<p>and</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐖</mi><mi>𝐢</mi><mo>−</mo><mi>𝐘</mi><mi>𝐢</mi><mo>=</mo><mn>𝟎</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">\mathbf{W}\mathbf{i} - \mathbf{Y}\mathbf{i} = \mathbf{0}.</annotation></semantics></math></p>
<p>Energy balance verification can be implemented with
<code>matsbyname</code> functions and <code>tidyverse</code> functional
programming:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Check</span> <span class="op">&lt;-</span> <span class="va">Energy</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    W <span class="op">=</span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/difference_byname.html" class="external-link">difference_byname</a></span><span class="op">(</span><span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/transpose_byname.html" class="external-link">transpose_byname</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span>, <span class="va">U</span><span class="op">)</span>,</span>
<span>    <span class="co"># Need to change column name and type on y so it can be subtracted from row sums of W</span></span>
<span>    err <span class="op">=</span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/difference_byname.html" class="external-link">difference_byname</a></span><span class="op">(</span><span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/rowsums_byname.html" class="external-link">rowsums_byname</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/rowsums_byname.html" class="external-link">rowsums_byname</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                              <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcolnames_byname.html" class="external-link">setcolnames_byname</a></span><span class="op">(</span><span class="st">"Industry"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Industry"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    EBalOK <span class="op">=</span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/iszero_byname.html" class="external-link">iszero_byname</a></span><span class="op">(</span><span class="va">err</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">Check</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">EBalOK</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Country Year EBalOK</span></span>
<span><span class="co">#&gt; 1      AB 2000   TRUE</span></span>
<span><span class="co">#&gt; 2      AB 2001   TRUE</span></span>
<span><span class="co">#&gt; 3      GB 2000   TRUE</span></span>
<span><span class="co">#&gt; 4      GB 2001   TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">Check</span><span class="op">$</span><span class="va">EBalOK</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>This example demonstrates that energy balance can be verified for
<em>all</em> combinations of Country and Year with a few lines of code.
In fact, the exact same code can be applied to the <code>Energy</code>
data frame, regardless of the number of rows in it.</p>
<p>Secure in the knowledge that energy is conserved across all ECCs in
the <code>Energy</code> data frame, other analyses can proceed.</p>
</div>
<div class="section level3">
<h3 id="efficiencies">Efficiencies<a class="anchor" aria-label="anchor" href="#efficiencies"></a>
</h3>
<p>To further illustrate the power of <code>matsbyname</code> functions
in the context of <code>matsindf</code>, consider the calculation of the
efficiency of every industry in the ECC as column vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation></semantics></math>
as shown by Equation 11 of Heun, Owen, and Brockway <span class="citation">(2018)</span>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐠</mi><mo>=</mo><mi>𝐕</mi><mi>𝐢</mi></mrow><annotation encoding="application/x-tex">\mathbf{g} = \mathbf{V}\mathbf{i}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝛈</mi><mo>=</mo><msup><mover><mrow><msup><mi>𝐔</mi><mi mathvariant="normal">T</mi></msup><mi>𝐢</mi></mrow><mo accent="true">̂</mo></mover><mrow><mi mathvariant="normal">−</mi><mn>1</mn></mrow></msup><mi>𝐠</mi></mrow><annotation encoding="application/x-tex">\mathbf{\eta} = \widehat{\mathbf{U}^\mathrm{T} \mathbf{i}}^{\mathrm{-}1} \mathbf{g}</annotation></semantics></math></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Etas</span> <span class="op">&lt;-</span> <span class="va">Energy</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    g <span class="op">=</span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/rowsums_byname.html" class="external-link">rowsums_byname</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span>,</span>
<span>    eta <span class="op">=</span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/transpose_byname.html" class="external-link">transpose_byname</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/rowsums_byname.html" class="external-link">rowsums_byname</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/hatize_byname.html" class="external-link">hatize_byname</a></span><span class="op">(</span>keep <span class="op">=</span> <span class="st">"rownames"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/invert_byname.html" class="external-link">invert_byname</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/matrixproduct_byname.html" class="external-link">matrixproduct_byname</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcolnames_byname.html" class="external-link">setcolnames_byname</a></span><span class="op">(</span><span class="st">"eta"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://matthewheun.github.io/matsbyname/reference/setcoltype.html" class="external-link">setcoltype</a></span><span class="op">(</span><span class="st">"Efficiency"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">eta</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Etas</span><span class="op">$</span><span class="va">eta</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;                         eta</span></span>
<span><span class="co">#&gt; Crude dist.       0.9884332</span></span>
<span><span class="co">#&gt; Diesel dist.      0.9774194</span></span>
<span><span class="co">#&gt; Elect. grid       0.9804688</span></span>
<span><span class="co">#&gt; Gas wells &amp; proc. 0.9518282</span></span>
<span><span class="co">#&gt; NG dist.          0.9987820</span></span>
<span><span class="co">#&gt; Oil fields        0.9485771</span></span>
<span><span class="co">#&gt; Oil refineries    0.8921933</span></span>
<span><span class="co">#&gt; Petrol dist.      0.9719626</span></span>
<span><span class="co">#&gt; Power plants      0.3975155</span></span>
<span><span class="co">#&gt; attr(,"rowtype")</span></span>
<span><span class="co">#&gt; [1] "Industry"</span></span>
<span><span class="co">#&gt; attr(,"coltype")</span></span>
<span><span class="co">#&gt; [1] "Efficiency"</span></span></code></pre></div>
<p>Note that only a few lines of code are required to perform the same
series of matrix operations on every combination of <code>Country</code>
and <code>Year</code>. In fact, the same code will be used to calculate
the efficiency of any number of industries in any number of countries
and years!</p>
</div>
<div class="section level3">
<h3 id="expand">Expand<a class="anchor" aria-label="anchor" href="#expand"></a>
</h3>
<p>Plotting values from a <code>matsindf</code> data frame can be
accomplished by <em>expand</em>ing the matrices of the
<code>matsindf</code> data frame (in this example, <code>Etas</code>)
back out to a tidy data frame. <em>Expand</em>ing is the reverse of
<em>collapse</em>-ing, and the following information must be supplied to
the <code>expand_to_tidy</code> function:</p>
<table class="table">
<colgroup>
<col width="57%">
<col width="42%">
</colgroup>
<thead><tr class="header">
<th align="right">argument to <code>expand_to_tidy</code>
</th>
<th align="left">identifies</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right"><code>matnames</code></td>
<td align="left">Name of the input column of matrix names</td>
</tr>
<tr class="even">
<td align="right"><code>matvals</code></td>
<td align="left">Name of the input column of matrices to be
expanded</td>
</tr>
<tr class="odd">
<td align="right"><code>rownames</code></td>
<td align="left">Name of the output column of matrix row names</td>
</tr>
<tr class="even">
<td align="right"><code>colnames</code></td>
<td align="left">Name of the output column of matrix column name</td>
</tr>
<tr class="odd">
<td align="right"><code>rowtypes</code></td>
<td align="left">Optional name of the output column of matrix row
types</td>
</tr>
<tr class="even">
<td align="right"><code>coltypes</code></td>
<td align="left">Optional name of the output column of matrix column
types</td>
</tr>
<tr class="odd">
<td align="right"><code>drop</code></td>
<td align="left">Optional value to be dropped from output (often 0)</td>
</tr>
</tbody>
</table>
<p>Prior to <code>expand</code>ing, it is usually necessary to
<code>gather</code> columns of matrices.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">etas_forgraphing</span> <span class="op">&lt;-</span> <span class="va">Etas</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">matrix.names</span>, value <span class="op">=</span> <span class="va">matrix</span>, <span class="va">eta</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/expand_to_tidy.html">expand_to_tidy</a></span><span class="op">(</span>matnames <span class="op">=</span> <span class="st">"matrix.names"</span>, matvals <span class="op">=</span> <span class="st">"matrix"</span>, </span>
<span>                 rownames <span class="op">=</span> <span class="st">"Industry"</span>, colnames <span class="op">=</span> <span class="st">"etas"</span>, </span>
<span>                 rowtypes <span class="op">=</span> <span class="st">"rowtype"</span>, coltypes <span class="op">=</span> <span class="st">"Efficiencies"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Eliminate columns we no longer need.</span></span>
<span>    matrix.names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    etas <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    rowtype <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    Efficiencies <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    eta <span class="op">=</span> <span class="va">matrix</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare to Figure 8 of Heun, Owen, and Brockway (2018)</span></span>
<span><span class="va">etas_forgraphing</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"GB"</span>, <span class="va">Year</span> <span class="op">==</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">#&gt;   Country Year  Industry            eta</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> GB      2000  Crude dist.       0.988</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> GB      2000  Diesel dist.      0.977</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GB      2000  Elect. grid       0.980</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> GB      2000  Gas wells &amp; proc. 0.952</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> GB      2000  NG dist.          0.999</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> GB      2000  Oil fields        0.949</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> GB      2000  Oil refineries    0.892</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> GB      2000  Petrol dist.      0.972</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> GB      2000  Power plants      0.398</span></span></code></pre></div>
<p><code>etas_forgraphing</code> is a data frame of efficiencies, one
for each Country, Year, and Industry, in a format that is amenable to
plotting with packages such as <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot</a>.</p>
</div>
<div class="section level3">
<h3 id="report">Report<a class="anchor" aria-label="anchor" href="#report"></a>
</h3>
<p>The following code creates a bar graph of efficiency results for the
UK in 2000:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">etas_UK_2000</span> <span class="op">&lt;-</span> <span class="va">etas_forgraphing</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"GB"</span>, <span class="va">Year</span> <span class="op">==</span> <span class="fl">2000</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">etas_UK_2000</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes_string</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Industry"</span>, y <span class="op">=</span> <span class="st">"eta"</span>, </span>
<span>                              fill <span class="op">=</span> <span class="st">"Industry"</span>, colour <span class="op">=</span> <span class="st">"Industry"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">eta</span><span class="op">[</span><span class="va">UK</span><span class="op">*</span><span class="st">","</span><span class="op">*</span><span class="fl">2000</span><span class="op">]</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">etas_UK_2000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gray20"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">etas_UK_2000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">FALSE</span>, colour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.4</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `aes_string()` was deprecated in ggplot2 3.0.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use tidy evaluation idioms with `aes()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See also `vignette("ggplot2-in-packages")` for more information.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as</span></span>
<span><span class="co">#&gt; of ggplot2 3.3.4.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="matsindf_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated the use of the <code>matsindf</code> and
<code>matsbyname</code> packages and suggested a workflow to accomplish
sophisticated analyses using <em>matrices in data frames</em>
(<code>matsindf</code>).</p>
<p>The workflow is as follows:</p>
<ul>
<li>Reshape data into a tidy data frame with columns for matrix name,
element value, row name, column name, row type, and column type, similar
to <code>UKEnergy2000</code> above.</li>
<li>Use <code>collapse_to_matrices</code> to create a data frame of
matrices with columns for matrix names and matrices themselves, similar
to <code>EnergyMats_2000</code> above.</li>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">tidyr::spread</a></code> the matrices to obtain a data frame with
columns for each matrix, similar to <code>Energy</code> above.</li>
<li>Validate the data, similar to <code>Check</code> above.</li>
<li>Perform matrix algebra operations on the columns of matrices using
<code>matsbyname</code> functions in a manner similar to the process of
generating the <code>Etas</code> data frame above.</li>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">tidyr::gather</a></code> the columns to obtain a tidy data frame
of matrices.</li>
<li>Use <code>expand_to_tidy</code> to create a tidy data frame of
matrix elements, similar to <code>etas_forgraphing</code> above.</li>
<li>Plot and report results as demonstrated by the graph above.</li>
</ul>
<p>Data frames of matrices, such as those created by
<code>matsindf</code>, are like magic spreadsheets in which single cells
contain entire matrices. With this data structure, analysts can wield
simultaneously the power of both <a href="https://en.wikipedia.org/wiki/Matrix_(mathematics)" class="external-link">matrix
mathematics</a> and <a href="https://www.tidyverse.org" class="external-link">tidyverse</a>
functional programming.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Heun:2018" class="csl-entry">
Heun, Matthew Kuperus, Anne Owen, and Paul E. Brockway. 2018. <span>“A
Physical Supply-Use Table Framework for Energy Analysis on the Energy
Conversion Chain.”</span> <em>Applied Energy</em> 226 (September):
1134–62. <a href="https://doi.org/10.1016/j.apenergy.2018.05.109" class="external-link">https://doi.org/10.1016/j.apenergy.2018.05.109</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
